{"remainingRequest":"/home/ubuntu/shellhub/ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ubuntu/shellhub/ui/src/components/terminal/TerminalDialog.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/ubuntu/shellhub/ui/src/components/terminal/TerminalDialog.vue","mtime":1589018514661},{"path":"/home/ubuntu/shellhub/ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ubuntu/shellhub/ui/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/ubuntu/shellhub/ui/node_modules/vuetify-loader/lib/loader.js","mtime":1574476662000},{"path":"/home/ubuntu/shellhub/ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ubuntu/shellhub/ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IFRlcm1pbmFsIH0gZnJvbSAneHRlcm0nOwppbXBvcnQgKiBhcyBmaXQgZnJvbSAneHRlcm0vbGliL2FkZG9ucy9maXQvZml0JzsKaW1wb3J0ICogYXMgYXR0YWNoIGZyb20gJ3h0ZXJtL2xpYi9hZGRvbnMvYXR0YWNoL2F0dGFjaCc7CmltcG9ydCAneHRlcm0vZGlzdC94dGVybS5jc3MnOwoKVGVybWluYWwuYXBwbHlBZGRvbihmaXQpOwpUZXJtaW5hbC5hcHBseUFkZG9uKGF0dGFjaCk7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ1Rlcm1pbmFsRGlhbG9nJywKCiAgcHJvcHM6IFsndWlkJ10sCgogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB1c2VybmFtZTogJycsCiAgICAgIHBhc3N3ZDogJycsCiAgICAgIHNob3dMb2dpbkZvcm06IHRydWUsCiAgICAgIHZhbGlkOiB0cnVlLAogICAgICBydWxlczogewogICAgICAgIHJlcXVpcmVkOiB2YWx1ZSA9PiAhIXZhbHVlIHx8ICdSZXF1aXJlZCcKICAgICAgfQogICAgfTsKICB9LAoKICB3YXRjaDogewogICAgc2hvdyh2YWx1ZSkgewogICAgICBpZiAoIXZhbHVlKSB7CiAgICAgICAgaWYgKHRoaXMud3MpIHRoaXMud3MuY2xvc2UoKTsKICAgICAgICBpZiAodGhpcy54dGVybSkgdGhpcy54dGVybS5kZXN0cm95KCk7CgogICAgICAgIHRoaXMudXNlcm5hbWUgPSAnJzsKICAgICAgICB0aGlzLnBhc3N3ZCA9ICcnOwogICAgICAgIHRoaXMuc2hvd0xvZ2luRm9ybSA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHsKICAgICAgICAgIHRoaXMuJHJlZnMudXNlcm5hbWUuZm9jdXMoKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0sCgogIGNvbXB1dGVkOiB7CiAgICBzaG93OiB7CiAgICAgIGdldCgpIHsKICAgICAgICByZXR1cm4gdGhpcy4kc3RvcmUuZ2V0dGVyc1snbW9kYWxzL3Rlcm1pbmFsJ10gPT09IHRoaXMuJHByb3BzLnVpZDsKICAgICAgfSwKCiAgICAgIHNldCh2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZSkgewogICAgICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ21vZGFscy90b2dnbGVUZXJtaW5hbCcsIHRoaXMuJHByb3BzLnVpZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtb2RhbHMvdG9nZ2xlVGVybWluYWwnLCAnJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwKCiAgbWV0aG9kczogewogICAgb3BlbigpIHsKICAgICAgdGhpcy54dGVybSA9IG5ldyBUZXJtaW5hbCh7CiAgICAgICAgY3Vyc29yQmxpbms6IHRydWUsCiAgICAgICAgZm9udEZhbWlseTogJ21vbm9zcGFjZScKICAgICAgfSk7CgogICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgnbW9kYWxzL3RvZ2dsZVRlcm1pbmFsJywgdGhpcy4kcHJvcHMudWlkKTsKCiAgICAgIGlmICh0aGlzLnh0ZXJtLmVsZW1lbnQpIHsKICAgICAgICB0aGlzLnh0ZXJtLnJlc2V0KCk7CiAgICAgIH0KICAgIH0sCgogICAgY2xvc2UoKSB7CiAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdtb2RhbHMvdG9nZ2xlVGVybWluYWwnLCAnJyk7CiAgICB9LAoKICAgIGNvbm5lY3QoKSB7CiAgICAgIHZhciBwcm90b2NvbENvbm5lY3Rpb25VUkwgPSAnJzsKCiAgICAgIGlmICghdGhpcy4kcmVmcy5mb3JtLnZhbGlkYXRlKHRydWUpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnNob3dMb2dpbkZvcm0gPSBmYWxzZTsKICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gdGhpcy54dGVybS5maXQoKSk7CgogICAgICBpZiAoIXRoaXMueHRlcm0uZWxlbWVudCkgewogICAgICAgIHRoaXMueHRlcm0ub3Blbih0aGlzLiRyZWZzLnRlcm1pbmFsKTsKICAgICAgfQoKICAgICAgdGhpcy54dGVybS5maXQoKTsKICAgICAgdGhpcy54dGVybS5mb2N1cygpOwoKICAgICAgY29uc3QgcGFyYW1zID0gT2JqZWN0LmVudHJpZXMoewogICAgICAgIHVzZXI6IGAke3RoaXMudXNlcm5hbWV9QCR7dGhpcy4kcHJvcHMudWlkfWAsCiAgICAgICAgcGFzc3dkOiBlbmNvZGVVUklDb21wb25lbnQodGhpcy5wYXNzd2QpLAogICAgICAgIGNvbHM6IHRoaXMueHRlcm0uY29scywKICAgICAgICByb3dzOiB0aGlzLnh0ZXJtLnJvd3MKICAgICAgfSkKICAgICAgICAubWFwKChbaywgdl0pID0+IHsKICAgICAgICAgIHJldHVybiBgJHtrfT0ke3Z9YDsKICAgICAgICB9KQogICAgICAgIC5qb2luKCcmJyk7CgogICAgICBpZihsb2NhdGlvbi5wcm90b2NvbCA9PSAiaHR0cDoiKXsKICAgICAgICBwcm90b2NvbENvbm5lY3Rpb25VUkwgPSAnd3MnCiAgICAgIH1lbHNlewogICAgICAgIHByb3RvY29sQ29ubmVjdGlvblVSTCA9ICd3c3MnCiAgICAgIH0KCiAgICAgIHRoaXMud3MgPSBuZXcgV2ViU29ja2V0KHByb3RvY29sQ29ubmVjdGlvblVSTCtgOi8vJHtsb2NhdGlvbi5ob3N0fS93cy9zc2g/JHtwYXJhbXN9YCk7CgogICAgICB0aGlzLndzLm9ub3BlbiA9ICgpID0+IHsKICAgICAgICB0aGlzLnh0ZXJtLmF0dGFjaCh0aGlzLndzLCB0cnVlLCB0cnVlKTsKICAgICAgfTsKCiAgICAgIHRoaXMud3Mub25jbG9zZSA9ICgpID0+IHsKICAgICAgICB0aGlzLnh0ZXJtLmRldGFjaCh0aGlzLndzKTsKICAgICAgfTsKICAgIH0sCgogICAgc2hvd0NvcHlTbmFjaygpIHsKICAgICAgdGhpcy5jb3B5U25hY2sgPSB0cnVlOwogICAgfQogIH0KfTsK"},{"version":3,"sources":["TerminalDialog.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiCA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"TerminalDialog.vue","sourceRoot":"src/components/terminal","sourcesContent":["<template>\n<v-dialog v-model=\"show\" max-width=\"1024px\">\n    \n  <template v-slot:activator=\"{ on }\">\n    <v-icon @click=\"open()\">mdi-console</v-icon>\n  </template>\n  \n  <v-card>\n    <v-toolbar dark color=\"primary\">\n      <v-btn icon dark @click=\"close()\">\n        <v-icon>close</v-icon>\n      </v-btn>\n      <v-toolbar-title>Terminal</v-toolbar-title>\n  \n      <v-spacer></v-spacer>\n    \n    </v-toolbar>\n    \n    <v-card class=\"ma-0 pa-6\" v-if=\"showLoginForm\" outlined>      \n      <v-form ref=\"form\" v-model=\"valid\" @submit.prevent=\"connect()\" lazy-validation>\n        <v-text-field label=\"Username\" v-model=\"username\" ref=\"username\" autofocus :rules=\"[rules.required]\" :validate-on-blur=\"true\"></v-text-field>\n        <v-text-field label=\"Password\" type=\"password\" v-model=\"passwd\" :rules=\"[rules.required]\" :validate-on-blur=\"true\"></v-text-field>\n        <v-btn type=\"submit\" color=\"primary\" class=\"mt-4\" rounded>Connect</v-btn>\n      </v-form>\n    </v-card>\n    \n    <div ref=\"terminal\"></div>\n  </v-card>\n\n</v-dialog>\n</template>\n\n<script>\nimport { Terminal } from 'xterm';\nimport * as fit from 'xterm/lib/addons/fit/fit';\nimport * as attach from 'xterm/lib/addons/attach/attach';\nimport 'xterm/dist/xterm.css';\n\nTerminal.applyAddon(fit);\nTerminal.applyAddon(attach);\n\nexport default {\n  name: 'TerminalDialog',\n\n  props: ['uid'],\n\n  data() {\n    return {\n      username: '',\n      passwd: '',\n      showLoginForm: true,\n      valid: true,\n      rules: {\n        required: value => !!value || 'Required'\n      }\n    };\n  },\n\n  watch: {\n    show(value) {\n      if (!value) {\n        if (this.ws) this.ws.close();\n        if (this.xterm) this.xterm.destroy();\n\n        this.username = '';\n        this.passwd = '';\n        this.showLoginForm = true;\n      } else {\n        requestAnimationFrame(() => {\n          this.$refs.username.focus();\n        });\n      }\n    }\n  },\n\n  computed: {\n    show: {\n      get() {\n        return this.$store.getters['modals/terminal'] === this.$props.uid;\n      },\n\n      set(value) {\n        if (value) {\n          this.$store.dispatch('modals/toggleTerminal', this.$props.uid);\n        } else {\n          this.$store.dispatch('modals/toggleTerminal', '');\n        }\n      }\n    }\n  },\n\n  methods: {\n    open() {\n      this.xterm = new Terminal({\n        cursorBlink: true,\n        fontFamily: 'monospace'\n      });\n\n      this.$store.dispatch('modals/toggleTerminal', this.$props.uid);\n\n      if (this.xterm.element) {\n        this.xterm.reset();\n      }\n    },\n\n    close() {\n      this.$store.dispatch('modals/toggleTerminal', '');\n    },\n\n    connect() {\n      var protocolConnectionURL = '';\n\n      if (!this.$refs.form.validate(true)) {\n        return;\n      }\n\n      this.showLoginForm = false;\n      this.$nextTick(() => this.xterm.fit());\n\n      if (!this.xterm.element) {\n        this.xterm.open(this.$refs.terminal);\n      }\n\n      this.xterm.fit();\n      this.xterm.focus();\n\n      const params = Object.entries({\n        user: `${this.username}@${this.$props.uid}`,\n        passwd: encodeURIComponent(this.passwd),\n        cols: this.xterm.cols,\n        rows: this.xterm.rows\n      })\n        .map(([k, v]) => {\n          return `${k}=${v}`;\n        })\n        .join('&');\n\n      if(location.protocol == \"http:\"){\n        protocolConnectionURL = 'ws'\n      }else{\n        protocolConnectionURL = 'wss'\n      }\n\n      this.ws = new WebSocket(protocolConnectionURL+`://${location.host}/ws/ssh?${params}`);\n\n      this.ws.onopen = () => {\n        this.xterm.attach(this.ws, true, true);\n      };\n\n      this.ws.onclose = () => {\n        this.xterm.detach(this.ws);\n      };\n    },\n\n    showCopySnack() {\n      this.copySnack = true;\n    }\n  }\n};\n</script>\n"]}]}